{% extends "collegeapp/base.html" %}
{% load static %}
{% block subcss %}
<link rel="stylesheet" href="{% static 'css/applyOnline.css' %} ">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
	.error-message-js {
		color: red;
		font-size: small;
	}
	.input-error {
		border-color: red;
	}
	.error-placeholder {
		height: 1em;
	}
</style>
{% endblock subcss %}
<!-- Hero section starts from here -->
{% block content %}
<div class="form">
    <div class="form-header">
        <h3>Student Application Form</h3>
        <p>Fill out the form below to start your journey with us</p>
        <div class="toast-container"></div>
        {% if messages %}
        {% for message in messages %}
        <script>
            showToast("{{ message|escapejs }}", "{% if 'Success' in message %}success{% else %}error{% endif %}");
            // Toaster
            function showToast(message, type = "success") {
                const toastContainer = document.querySelector(".toast-container");
        
                const toast = document.createElement("div");
                toast.classList.add("toast", type);
        
                toast.innerHTML = `
            <div class="toast-content">
                <i class="fa-solid ${getIcon(type)}"></i>  <!-- Ensure fa-solid is used -->
                <div class="message">
                    <span class="text text-1">${capitalize(type)}</span>
                    <span class="text text-2">${message}</span>
                </div>
            </div>
            <i class="fa-solid fa-xmark close"></i>
            <div class="progress active"></div>
        `;
        
                toastContainer.appendChild(toast);
                let showToast = setTimeout(() => {
                    void toast.offsetHeight;
                    toast.classList.add("active");
                }, 1);
        
                const progress = toast.querySelector(".progress");
                const closeIcon = toast.querySelector(".close");
        
                // Auto-remove toast after 5s
                const timer1 = setTimeout(() => {
                    toast.classList.remove("active");
                }, 5000);
        
                const timer2 = setTimeout(() => {
                    progress.classList.remove("active");
                    setTimeout(() => toast.remove(), 400);
                }, 5300);
        
                // Manual close
                closeIcon.addEventListener("click", () => {
                    toast.classList.remove("active");
                    clearTimeout(timer1);
                    clearTimeout(timer2);
                    clearTimeout(showToast);
                    setTimeout(() => toast.remove(), 400);
                });
            }
        
            function getIcon(type) {
                switch (type) {
                    case "success": return "fa-circle-check";
                    case "error": return "fa-circle-xmark"; 
                    case "warning": return "fa-triangle-exclamation";
                    case "info": return "fa-circle-info";
                    default: return "fa-circle-check";
                }
            }
        
            function capitalize(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }
        
        
        </script>
        {% endfor %}
        {% endif %}
    </div>

    <form action="/apply-online" method="POST">
        {% csrf_token %}

        <div class="row">
            <label for="fullname">Full Name</label>
            <div class="input-group">
                <i class="fas fa-user"></i>
                <input type="text" name="fullname" id="fullname" required>
            </div>
            <div class="error-placeholder"><div id="name-error" class="error-message-js"></div></div>
        </div>
        
        <div class="row">
            <div class="col">
                <label for="program">Select Program</label>
                <div class="input-group">
                    <i class="fas fa-graduation-cap"></i>
                    <select name="program" id="program" required>
                        <option value="" disabled selected>Choose a program</option>
                        <option value="Bsc.CSIT">Bsc.CSIT</option>
                        <option value="BCA">BCA</option>
                        <option value="plus2">+2</option>
                        <option value="School">School</option>
                        <option value="BBS">BBS</option>
                    </select>
                </div>
                <!-- <div class="error-placeholder"><div id="program-error" class="error-message-js"></div></div> -->
            </div>

            <div class="col">
                <label for="phone">Phone Number</label>
                <div class="input-group">
                    <i class="fas fa-phone"></i>
                    <input type="tel" name="phone" id="phone" required>
                </div>
                <div class="error-placeholder"><div id="phone-error" class="error-message-js"></div></div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="email">Email</label>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" name="email" id="email" required>
                </div>
                <div class="error-placeholder"><div id="email-error" class="error-message-js"></div></div>
            </div>
            <div class="col">
                <label for="previouscollege">Previous College / School Name</label>
                <div class="input-group">
                    <i class="fas fa-school"></i>
                    <input type="text" name="previouscollege" id="previouscollege" required>
                </div>
                <div class="error-placeholder"><div id="pre-clz-error" class="error-message-js"></div></div>
            </div>
        </div>

        <div class="row">
            <label for="message">Your Queries (Optional)</label>
            <div class="input-group">
                <i class="fas fa-comment"></i>
                <textarea name="message" id="message"></textarea>
            </div>
        </div>
        <div class="row">
            <div class="g-recaptcha" data-sitekey="6Lf31c4qAAAAAM9M78hujvLYJ-k-tVsiNCWo4IBy"></div>
        </div>

        <div class="row submit-row">
            <button type="submit">
                <span>Submit Application</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </form>
</div>
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endblock content %}